define([], function() {	'use strict';	return [function() {		var storageKey = 'auth_token';		var roles = {			STUDENT: {				level: 0,				dashboard: 'base.app.dashboard'			},			MARKER: {				level: 1,				dashboard: 'base.app.marker.dashboard'			},			COURSE_OWNER: {				level: 2,				dashboard: 'base.app.courseOwner.dashboard'			},			ADMIN: {				level: 3,				dashboard: 'base.app.admin.dashboard'			}		};		var userInfo = {			init: false,			user: null,			token: undefined,			setUser: function(token) {				if(token !== null) {					var userData = JSON.parse(atob(token.split('.')[0]));					if (userData.roles) {						userData.maxRole = userData.roles.sort(function (r1, r2) {							return roles[r2].level - roles[r1].level;						})[0];						userData.defaultState = roles[userData.maxRole].dashboard;					} else {						userData.maxRole = -1; // No roles					}					this.user = userData;					this.init = true;					this.token = token;				}			},			clear: function() {				this.init = false;				this.user = null;				this.token = undefined;			}		};		return {			store: function(token) {				userInfo.clear();				localStorage.setItem(storageKey, token);			},			retrieve: function() {				return localStorage.getItem(storageKey);			},			clear: function() {				userInfo.clear();				return localStorage.removeItem(storageKey);			},			userInfo: function() {				var token = localStorage.getItem(storageKey);				if(!userInfo.init || userInfo.token !== token) {					userInfo.setUser(token);				}				return userInfo.user;			}		};	}];});